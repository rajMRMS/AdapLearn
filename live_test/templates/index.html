<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Live Test â€” DTransformer</title>
    <style>body{font-family:Segoe UI,Arial;margin:20px} .q{margin-bottom:16px}</style>
  </head>
  <body>
    <h1>Live Test</h1>
    <div>
      User: <input id="user" value="tester" />
    </div>
    <div id="questions"></div>
    <button id="submit">Submit</button>
    <script>
      async function load(){
        const res = await fetch('/questions');
        const qs = await res.json();
        const container = document.getElementById('questions');
        qs.forEach(q=>{
          const div = document.createElement('div'); div.className='q';
          const h = document.createElement('div'); h.textContent = q.text; div.appendChild(h);
          if(q.type==='mcq'){
            q.options.forEach(opt=>{
              const id = q.id+'_'+opt;
              const label = document.createElement('label');
              label.innerHTML = `<input type="radio" name="${q.id}" value="${opt}" /> ${opt}`;
              div.appendChild(label);
            });
          }
          container.appendChild(div);
        });
      }
      document.getElementById('submit').addEventListener('click', async ()=>{
        const user = document.getElementById('user').value||'anon';
        const answers = [];
        document.querySelectorAll('.q').forEach(q=>{
          const radios = q.querySelectorAll('input[type=radio]');
          if(radios.length){
            radios.forEach(r=>{ if(r.checked) answers.push({qid:r.name, answer:r.value}) });
          }
        });
        const res = await fetch('/submit', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user, answers})});
        const data = await res.json();
        alert('Saved: '+data.saved);
      });
      load();
    </script>
  </body>
 </html>
